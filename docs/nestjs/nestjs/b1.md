ä¸‹é¢æˆ‘**æŒ‰çœŸå® NestJS é¡¹ç›®ç»“æ„**ï¼Œç³»ç»Ÿåœ°è®²æ¸…æ¥š **NestJS + TypeORM + MySQL** çš„**å®‰è£…ã€é…ç½®ã€æ–‡ä»¶æ”¾ç½®ä½ç½®ã€ä»¥åŠæœ€åŸºç¡€çš„ CRUD ä½¿ç”¨æµç¨‹**ã€‚
ä½ å¯ä»¥æŠŠè¿™å½“æˆ **â€œèƒ½è·‘èµ·æ¥çš„æœ€å°æ­£ç¡®èŒƒå¼â€**ã€‚

---

## ä¸€ã€æ•´ä½“æ¶æ„ä¸€çœ¼çœ‹æ‡‚ï¼ˆå…ˆæœ‰å…¨å±€è®¤çŸ¥ï¼‰

```txt
src/
â”œâ”€â”€ app.module.ts          # æ ¹æ¨¡å—ï¼šæ³¨å†Œ TypeORM
â”œâ”€â”€ main.ts                # å¯åŠ¨å…¥å£
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ database.config.ts # æ•°æ®åº“é…ç½®ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰
â”‚
â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ user.entity.ts     # Entityï¼ˆè¡¨ç»“æ„ï¼‰
â”‚   â”œâ”€â”€ users.module.ts
â”‚   â”œâ”€â”€ users.service.ts   # å†™æ•°æ®åº“é€»è¾‘
â”‚   â””â”€â”€ users.controller.ts
```

**æ ¸å¿ƒåŸåˆ™ä¸€å¥è¯ï¼š**

> **Entity æè¿°è¡¨ â†’ Service æ“ä½œæ•°æ®åº“ â†’ Module è´Ÿè´£æ³¨å…¥ â†’ AppModule è¿æ¥æ•°æ®åº“**

---

## äºŒã€å®‰è£…ä¾èµ–ï¼ˆå¿…é¡»ï¼‰

```bash
npm install @nestjs/typeorm typeorm mysql2
```

ä¾èµ–ä½œç”¨è¯´æ˜ï¼š

| åŒ…                 | ä½œç”¨                     |
| ----------------- | ---------------------- |
| `@nestjs/typeorm` | NestJS å’Œ TypeORM çš„æ¡¥æ¢   |
| `typeorm`         | ORM æ ¸å¿ƒ                 |
| `mysql2`          | MySQL é©±åŠ¨ï¼ˆTypeORM å®˜æ–¹æ¨èï¼‰ |

---

## ä¸‰ã€é…ç½® TypeORMï¼ˆå†™åœ¨å“ªé‡Œï¼Ÿæ€ä¹ˆå†™ï¼Ÿï¼‰

### âœ… æ¨èå†™æ³• 1ï¼šç›´æ¥å†™åœ¨ `app.module.ts`ï¼ˆæ–°æ‰‹æœ€æ¸…æ™°ï¼‰

```ts
// src/app.module.ts
import { Module } from '@nestjs/common'
import { TypeOrmModule } from '@nestjs/typeorm'
import { User } from './users/user.entity'

@Module({
  imports: [
    TypeOrmModule.forRoot({
      type: 'mysql',
      host: 'localhost',
      port: 3306,
      username: 'root',
      password: '123456',
      database: 'test_db',

      entities: [User], // æˆ– __dirname + '/**/*.entity{.ts,.js}'
      synchronize: true, // â—å¼€å‘ç¯å¢ƒç”¨ï¼Œç”Ÿäº§ç¦ç”¨
    }),
  ],
})
export class AppModule {}
```

ğŸ“Œ **å…³é”®ç‚¹è§£é‡Šï¼ˆé¢è¯•å¸¸é—®ï¼‰**

| é…ç½®é¡¹           | è¯´æ˜                    |
| ------------- | --------------------- |
| `entities`    | å‘Šè¯‰ TypeORM å“ªäº›ç±»æ˜¯è¡¨      |
| `synchronize` | è‡ªåŠ¨å»ºè¡¨ï¼ˆâš ï¸ ç”Ÿäº§ç¯å¢ƒå¿…é¡» falseï¼‰ |
| `forRoot()`   | **å…¨å±€æ•°æ®åº“è¿æ¥ï¼Œåªèƒ½ä¸€æ¬¡**      |

---

### âœ… æ¨èå†™æ³• 2ï¼šæŠ½æˆé…ç½®æ–‡ä»¶ï¼ˆä¸­å¤§å‹é¡¹ç›®ï¼‰

```ts
// src/config/database.config.ts
import { TypeOrmModuleOptions } from '@nestjs/typeorm'

export const typeOrmConfig: TypeOrmModuleOptions = {
  type: 'mysql',
  host: 'localhost',
  port: 3306,
  username: 'root',
  password: '123456',
  database: 'test_db',
  autoLoadEntities: true,
  synchronize: true,
}
```

```ts
// app.module.ts
TypeOrmModule.forRoot(typeOrmConfig)
```

ğŸ“Œ `autoLoadEntities: true` = **åªè¦ Module å¼•å…¥ Entity å°±ä¼šç”Ÿæ•ˆ**

---

## å››ã€Entityï¼ˆè¡¨ç»“æ„ï¼‰æ€ä¹ˆå†™ï¼Ÿå†™åœ¨å“ªé‡Œï¼Ÿ

ğŸ“**ä½ç½®ï¼šåŠŸèƒ½æ¨¡å—å†…éƒ¨**

```ts
// src/users/user.entity.ts
import { Entity, Column, PrimaryGeneratedColumn } from 'typeorm'

@Entity('users') // è¡¨å
export class User {
  @PrimaryGeneratedColumn()
  id: number

  @Column({ length: 50 })
  username: string

  @Column()
  email: string
}
```

### ğŸ“Œ Entity æ˜¯ä»€ä¹ˆï¼Ÿ

| æ¦‚å¿µ     | å¯¹åº”å…³ç³»    |
| ------ | ------- |
| Entity | MySQL è¡¨ |
| å±æ€§     | è¡¨å­—æ®µ     |
| è£…é¥°å™¨    | è¡¨ç»“æ„çº¦æŸ   |

---

## äº”ã€Module ä¸­æ³¨å†Œ Entityï¼ˆéå¸¸å…³é”®ï¼‰

```ts
// src/users/users.module.ts
import { Module } from '@nestjs/common'
import { TypeOrmModule } from '@nestjs/typeorm'
import { User } from './user.entity'
import { UsersService } from './users.service'
import { UsersController } from './users.controller'

@Module({
  imports: [TypeOrmModule.forFeature([User])],
  providers: [UsersService],
  controllers: [UsersController],
})
export class UsersModule {}
```

ğŸ“Œ **ä¸€å¥è¯è®°å¿†**

> `forRoot()` è¿æ•°æ®åº“
> `forFeature()` è®© Entity åœ¨å½“å‰æ¨¡å—å¯æ³¨å…¥

---

## å…­ã€Service ä¸­æ“ä½œ MySQLï¼ˆæ ¸å¿ƒï¼‰

### 1ï¸âƒ£ æ³¨å…¥ Repositoryï¼ˆæœ€å¸¸ç”¨ï¼‰

```ts
// src/users/users.service.ts
import { Injectable } from '@nestjs/common'
import { InjectRepository } from '@nestjs/typeorm'
import { Repository } from 'typeorm'
import { User } from './user.entity'

@Injectable()
export class UsersService {
  constructor(
    @InjectRepository(User)
    private readonly userRepo: Repository<User>,
  ) {}

  findAll() {
    return this.userRepo.find()
  }

  findOne(id: number) {
    return this.userRepo.findOneBy({ id })
  }

  create(data: Partial<User>) {
    const user = this.userRepo.create(data)
    return this.userRepo.save(user)
  }

  remove(id: number) {
    return this.userRepo.delete(id)
  }
}
```

---

### 2ï¸âƒ£ å¸¸ç”¨ Repository APIï¼ˆä½ å¿…é¡»ç†Ÿï¼‰

| æ–¹æ³•            | ä½œç”¨        |
| ------------- | --------- |
| `find()`      | æŸ¥å¤šæ¡       |
| `findOneBy()` | æŒ‰æ¡ä»¶æŸ¥ä¸€æ¡    |
| `create()`    | åˆ›å»ºå®ä½“ï¼ˆä¸å…¥åº“ï¼‰ |
| `save()`      | æ’å…¥ / æ›´æ–°   |
| `delete()`    | åˆ é™¤        |
| `update()`    | å±€éƒ¨æ›´æ–°      |

---

## ä¸ƒã€Controller è°ƒç”¨ Serviceï¼ˆå®Œæ•´é“¾è·¯ï¼‰

```ts
// src/users/users.controller.ts
import { Controller, Get, Post, Body, Param } from '@nestjs/common'
import { UsersService } from './users.service'

@Controller('users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Get()
  findAll() {
    return this.usersService.findAll()
  }

  @Post()
  create(@Body() body) {
    return this.usersService.create(body)
  }
}
```

è®¿é—®ï¼š

```txt
GET  /users
POST /users
```

---

## å…«ã€æ•´ä¸ªæ•°æ®æµï¼ˆéå¸¸é‡è¦ï¼‰

```txt
HTTP è¯·æ±‚
   â†“
Controller
   â†“
Service
   â†“
Repository
   â†“
TypeORM
   â†“
MySQL
```

---

## ä¹ã€æ–°æ‰‹æœ€å®¹æ˜“çŠ¯çš„ 5 ä¸ªé”™è¯¯ âŒ

1ï¸âƒ£ å¿˜è®°åœ¨ `Module` é‡Œ `forFeature([Entity])`
2ï¸âƒ£ Entity æ²¡è¢« `forRoot` æˆ– `autoLoadEntities` åŠ è½½
3ï¸âƒ£ `synchronize: true` ç”¨åœ¨ç”Ÿäº§
4ï¸âƒ£ åœ¨ Controller é‡Œç›´æ¥æ“ä½œ Repository
5ï¸âƒ£ Entity å†™åœ¨ `common/` å¯¼è‡´æ¨¡å—å…³ç³»æ··ä¹±

---

## åã€ä½ ç°åœ¨çš„**æœ€ä½³å­¦ä¹ è·¯å¾„ï¼ˆéå¸¸é€‚åˆä½ ï¼‰**

ç»“åˆä½ ç›®å‰ **Express / Prisma / MySQL / NestJS** çš„èƒŒæ™¯ï¼Œæˆ‘å»ºè®®ï¼š

1ï¸âƒ£ ç†Ÿç»ƒ **Repository CRUDï¼ˆä»Šå¤©å°±èƒ½æŒæ¡ï¼‰**
2ï¸âƒ£ å­¦ `QueryBuilder`ï¼ˆå¤æ‚æŸ¥è¯¢ï¼‰
3ï¸âƒ£ DTO + class-validator
4ï¸âƒ£ ä¸€å¯¹å¤š / å¤šå¯¹å¤šå…³ç³»
5ï¸âƒ£ TypeORM vs Prisma çš„å–èˆï¼ˆä½ ä»¥åä¸€å®šä¼šé—®ï¼‰

---

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç›´æ¥å¸®ä½ ï¼š

* âœ… ç”¨ **TypeORM å†™ä¸€å¥—å®Œæ•´ CRUD ç¤ºä¾‹**
* âœ… å¯¹æ¯” **TypeORM vs Prismaï¼ˆExpress & NestJSï¼‰**
* âœ… è®² **ä¸ºä»€ä¹ˆå¾ˆå¤š NestJS é¡¹ç›®æœ€åä¸ç”¨ TypeORM**
* âœ… æ•™ä½  **æ•°æ®åº“è¿ç§»ï¼ˆmigrationï¼‰æ­£ç¡®å§¿åŠ¿**

ä½ ç›´æ¥è¯´ä¸€å¥ï¼š**â€œä¸‹ä¸€æ­¥å­¦ Xâ€** å³å¯ã€‚


